!function(t){"use strict";var i=function(i,e){this.el=t(i),this.options=t.extend({},t.fn.telewriter.defaults,e),this.text=this.el.text(),this.speed=0,this.input=this.options.input,this.loop=this.options.loop,this.buffer="",this.mark=-1,this.dir=!0,this.pos=0,this.build()};i.prototype={constructor:i,init:function(){var t=this;t.typewrite()},build:function(){this.el.after('<span id="telewriter-cursor">â”ƒ</span>'),this._cursor=t("#typed-cursor"),this.init()},tick:function(t,i){this._paused?(this.__func=t,this._timeout=i):(this.__func=t,this._nextTick=setTimeout(t,i),this._tick=Date.now(),this._timeout=i)},typewrite:function(){var t=this;if(0==t.dir)return void(t.buffer.length>t.mark?0==t.speed?(t.buffer=t.buffer.substr(0,t.mark),t.el.text(t.buffer),t.dir=!0,t.tick(t.typewrite.bind(this),0)):(t.buffer=t.buffer.substr(0,t.buffer.length-1),t.el.text(t.buffer),t.tick(t.typewrite.bind(this),t.speed)):t.dir=!0);if(t.pos>=t.input.length)return void(t.loop&&(t.pos=0,t.mark=-1,t.dir=!0,t.buffer="",t.tick(t.typewrite.bind(this),0)));var i=t.input[t.pos];if("^"==i)if(t.pos+1>=t.input.length)t.pos+=1,t.tick(t.typewrite.bind(this),0);else if(/^\^\d+\^/.test(t.input.substr(t.pos))){var e=/\d+/.exec(t.input.substr(t.pos+1))[0],s=e.length,r=parseInt(e);t.pos+=2+s,console.log("speed set from ",t.speed," to ",r),t.speed=r,t.tick(t.typewrite.bind(this),0)}else"^"==t.input[t.pos+1]?(t.pos+=2,t.buffer+="^",t.el.text(t.buffer),t.tick(t.typewrite.bind(this),t.speed)):"_"==t.input[t.pos+1]?(t.pos+=2,t.tick(t.typewrite.bind(this),t.speed)):"*"==t.input[t.pos+1]?(t.pos+=2,t.mark=t.buffer.length,t.tick(t.typewrite.bind(this),0)):"-"==t.input[t.pos+1]&&(t.pos+=2,t.dir=!1,t.tick(t.typewrite.bind(this),0));else if(t.dir)if(0==t.speed){var o=t.pos+1;for(o=t.pos+1;o<t.input.length&&"^"!=t.input[o];o++);t.buffer+=t.input.substr(t.pos,o-t.pos),t.pos=o,t.el.text(t.buffer),t.tick(t.typewrite.bind(this),t.speed)}else t.buffer+=i,t.pos+=1,t.el.text(t.buffer),t.tick(t.typewrite.bind(this),t.speed);t.options.callback&&t.options.callback()},pause:function(){this._paused=Date.now(),console.log("Paused!",this._nextTick),this._cursor.removeClass("cursor"),this._nextTick&&(clearTimeout(this._nextTick),this._nextTick=null,this._timeout=this._timeout-(Date.now()-this._tick),this._timeout<0&&(this._timeout=0))},resume:function(){this._cursor.addClass("cursor"),this._paused&&(this._paused=!1,console.log("Resume",this.__func,this._timeout),this.tick(this.__func,this._timeout))}},t.fn.telewriter=function(e){return this.each(function(){var s=t(this),r=s.data("telewriter"),o="object"==typeof e&&e;r||s.data("telewriter",r=new i(this,o)),"string"==typeof e&&r[e]()})},t.fn.telewriter.defaults={loop:!0}}(jQuery);